<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>E-Commerce Delivery Optimization System</title>
  <script src="https://unpkg.com/konva@8.3.8/konva.min.js"></script>

  <style>
    body {
      font-family: "Space Mono", monospace;
      background: #0b132b;
      color: #e0f7fa;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    .header {
      text-align: center;
      font-size: 1.4rem;
      text-transform: uppercase;
      padding: 15px;
      color: #00bcd4;
      text-shadow: 0 0 5px #00bcd4;
    }

    .dashboard {
      display: flex;
      flex-wrap: wrap;
      padding: 10px;
      gap: 15px;
      flex-grow: 1;
      justify-content: center;
    }

    .panel {
      background: rgba(20, 30, 50, 0.8);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 15px;
      flex: 1 1 300px;
      min-height: 200px;
      box-shadow: 0 0 10px rgba(0, 188, 212, 0.3);
    }

    h3 {
      color: #00bcd4;
      border-bottom: 1px dashed rgba(255, 255, 255, 0.1);
      padding-bottom: 5px;
    }

    .btn {
      background: #ff007f;
      border: none;
      padding: 8px 10px;
      color: white;
      font-weight: bold;
      border-radius: 6px;
      margin: 5px 0;
      cursor: pointer;
      box-shadow: 0 0 8px #ff007f;
    }
    .btn:hover {
      background: #ff3399;
    }

    input {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid #00bcd4;
      color: white;
      border-radius: 5px;
      padding: 4px 6px;
      width: 60px;
    }

    #map {
      width: 100%;
      height: 400px;
      background: rgba(0, 188, 212, 0.05);
      border-radius: 8px;
    }

    #log {
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid #00bcd4;
      padding: 10px;
      border-radius: 5px;
      font-size: 0.9rem;
      height: 200px;
      overflow-y: auto;
      white-space: pre-wrap;
    }
  </style>
</head>

<body>
  <div class="header">E-Commerce Delivery Optimization System</div>

  <div class="dashboard">
    <div class="panel">
      <h3>ðŸ—º Delivery Map</h3>
      <div id="map"></div>
    </div>

    <div class="panel">
      <h3>âš™ Controls</h3>
      <div>
        <label>Cities (4â€“6):</label>
        <input id="cityCount" type="number" min="4" max="6" value="4" />
        <button class="btn" onclick="app.generateMap()">Generate</button>
      </div>

      <button class="btn" onclick="app.runTSP()">Optimize Route (TSP)</button>
      <button class="btn" onclick="app.runColoring()">Assign Zones</button>

      <div>
        <label>Capacity (kg):</label>
        <input id="capacity" type="number" min="10" value="50" />
        <button class="btn" onclick="app.runKnapsack()">Optimize Load</button>
      </div>

      <button class="btn" onclick="app.showMatrix()">Show Distance Matrix</button>
      <button class="btn" onclick="document.getElementById('log').innerHTML='System Ready...';">
        Clear Log
      </button>
    </div>

    <div class="panel">
      <h3>ðŸ“Š System Log</h3>
      <div id="log">System Ready...</div>
    </div>
  </div>

  <script>
    const app = {
      coords: [],
      distance: [],
      items: [],
      stage: null,
      layer: null,
      CITY_RADIUS: 15,
      COLORS: ["#00FF00", "#FFD700", "#FF4500", "#00BFFF", "#FF69B4"],

      init() {
        const mapDiv = document.getElementById("map");
        this.stage = new Konva.Stage({
          container: "map",
          width: mapDiv.clientWidth,
          height: mapDiv.clientHeight,
        });
        this.layer = new Konva.Layer();
        this.stage.add(this.layer);
        this.generateMap();
      },

      distanceBetween(a, b) {
        return Math.round(Math.hypot(a.x - b.x, a.y - b.y) * 100) / 100;
      },

      generateMap() {
        const n = parseInt(document.getElementById("cityCount").value);
        const w = this.stage.width() - 50;
        const h = this.stage.height() - 50;
        this.coords = [];
        this.items = [];
        this.layer.destroyChildren();

        for (let i = 0; i < n; i++) {
          this.coords.push({
            x: Math.random() * w + 25,
            y: Math.random() * h + 25,
          });
        }

        // build distance matrix
        this.distance = Array(n)
          .fill(0)
          .map(() => Array(n).fill(0));
        for (let i = 0; i < n; i++) {
          for (let j = 0; j < n; j++) {
            if (i !== j)
              this.distance[i][j] = this.distanceBetween(this.coords[i], this.coords[j]);
          }
        }

        // draw nodes
        for (let i = 0; i < n; i++) {
          const circle = new Konva.Circle({
            x: this.coords[i].x,
            y: this.coords[i].y,
            radius: this.CITY_RADIUS,
            fill: "#00bcd4",
            stroke: "white",
            strokeWidth: 2,
          });
          const text = new Konva.Text({
            x: this.coords[i].x - 4,
            y: this.coords[i].y - 5,
            text: i + 1,
            fontSize: 12,
            fill: "white",
          });
          this.layer.add(circle);
          this.layer.add(text);
        }
        this.layer.draw();
        this.log(`Generated ${n} cities on map.`);
      },

      tsp() {
        const n = this.distance.length;
        const nodes = [...Array(n).keys()];
        let best = Infinity,
          path = [];

        const permute = (arr) =>
          arr.length === 0
            ? [[]]
            : arr.flatMap((e, i) =>
                permute(arr.filter((_, j) => i !== j)).map((x) => [e, ...x])
              );

        for (const p of permute(nodes.slice(1))) {
          const route = [0, ...p, 0];
          let cost = 0;
          for (let i = 0; i < route.length - 1; i++)
            cost += this.distance[route[i]][route[i + 1]];
          if (cost < best) {
            best = cost;
            path = route;
          }
        }
        return { path, cost: Math.round(best * 100) / 100 };
      },

      runTSP() {
        if (this.coords.length < 2) return alert("Generate map first!");
        const res = this.tsp();
        this.log(`Shortest route: ${res.path.join(" â†’ ")}`);
        this.log(`Total distance: ${res.cost} units`);
        this.drawRoute(res.path);
      },

      greedyColoring() {
        const n = this.distance.length;
        const colors = Array(n).fill(-1);
        colors[0] = 0;
        for (let i = 1; i < n; i++) {
          const used = [];
          for (let j = 0; j < n; j++)
            if (i !== j && colors[j] !== -1) used[colors[j]] = true;
          let c = 0;
          while (used[c]) c++;
          colors[i] = c;
        }
        return colors;
      },

      runColoring() {
        if (this.coords.length < 1) return alert("Generate map first!");
        const colors = this.greedyColoring();
        this.layer.destroyChildren();
        for (let i = 0; i < this.coords.length; i++) {
          const circle = new Konva.Circle({
            x: this.coords[i].x,
            y: this.coords[i].y,
            radius: this.CITY_RADIUS,
            fill: this.COLORS[colors[i] % this.COLORS.length],
            stroke: "white",
            strokeWidth: 2,
          });
          const text = new Konva.Text({
            x: this.coords[i].x - 4,
            y: this.coords[i].y - 5,
            text: i + 1,
            fontSize: 12,
            fill: "white",
          });
          this.layer.add(circle);
          this.layer.add(text);
        }
        this.layer.draw();
        this.log("Assigned zones using Greedy Coloring.");
      },

      knapsack(weights, values, cap) {
        const n = weights.length;
        const dp = Array(n + 1)
          .fill(0)
          .map(() => Array(cap + 1).fill(0));
        for (let i = 1; i <= n; i++) {
          for (let w = 0; w <= cap; w++) {
            if (weights[i - 1] <= w)
              dp[i][w] = Math.max(
                values[i - 1] + dp[i - 1][w - weights[i - 1]],
                dp[i - 1][w]
              );
            else dp[i][w] = dp[i - 1][w];
          }
        }
        return dp[n][cap];
      },

      runKnapsack() {
        const cap = parseInt(document.getElementById("capacity").value);
        const weights = [10, 20, 30, 15, 25];
        const values = [60, 100, 120, 80, 70];
        const maxVal = this.knapsack(weights, values, cap);
        this.log(`Max load value for capacity ${cap}kg: ${maxVal}`);
      },

      drawRoute(path) {
        this.layer.destroyChildren();
        for (let i = 0; i < this.coords.length; i++) {
          const circle = new Konva.Circle({
            x: this.coords[i].x,
            y: this.coords[i].y,
            radius: this.CITY_RADIUS,
            fill: "#00bcd4",
            stroke: "white",
            strokeWidth: 2,
          });
          this.layer.add(circle);
        }
        for (let i = 0; i < path.length - 1; i++) {
          const a = this.coords[path[i]];
          const b = this.coords[path[i + 1]];
          const line = new Konva.Line({
            points: [a.x, a.y, b.x, b.y],
            stroke: "#ff007f",
            strokeWidth: 3,
            lineCap: "round",
            lineJoin: "round",
          });
          this.layer.add(line);
        }
        this.layer.draw();
      },

      showMatrix() {
        if (!this.distance.length) return alert("Generate map first!");
        let msg = "Distance Matrix:\n";
        for (let i = 0; i < this.distance.length; i++) {
          msg += this.distance[i].map((x) => x.toFixed(1)).join("\t") + "\n";
        }
        alert(msg);
      },

      log(txt) {
        const log = document.getElementById("log");
        log.innerHTML += "\n" + txt;
        log.scrollTop = log.scrollHeight;
      },
    };

    document.addEventListener("DOMContentLoaded", () => {
      const link = document.createElement("link");
      link.rel = "stylesheet";
      link.href =
        "https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&display=swap";
      document.head.appendChild(link);
      app.init();
    });
  </script>
</body>
</html>